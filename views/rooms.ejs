<div class="row mb-4">
  <div class="col-md-8">
    <h1>Available Rooms</h1>
  </div>
  <div class="col-md-4 text-end">
    <form id="search-form" class="d-flex">
      <input type="date" id="search-date" class="form-control me-2" value="<%= new Date().toISOString().split('T')[0] %>">
      <button type="submit" class="btn btn-primary">Search</button>
    </form>
  </div>
</div>

<div class="row" id="rooms-container">
  <!-- Rooms will be loaded here -->
  <div class="col-12 text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Load rooms on page load
    loadRooms();
    
    // Handle search form submission
    document.getElementById('search-form').addEventListener('submit', function(e) {
      e.preventDefault();
      loadRooms();
    });
    
    function loadRooms() {
      const searchDate = document.getElementById('search-date').value;
      const startTime = new Date(`${searchDate}T00:00:00`).toISOString();
      const endTime = new Date(`${searchDate}T23:59:59`).toISOString();
      
      // Show loading spinner
      document.getElementById('rooms-container').innerHTML = `
        <div class="col-12 text-center">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      `;
      
      // Fetch available rooms
      fetch(`/api/rooms/available?start_time=${startTime}&end_time=${endTime}`)
        .then(response => response.json())
        .then(rooms => {
          if (rooms.length === 0) {
            document.getElementById('rooms-container').innerHTML = `
              <div class="col-12">
                <div class="alert alert-info">
                  No rooms available for the selected date. Please try another date.
                </div>
              </div>
            `;
            return;
          }
          
          // Display rooms
          let roomsHtml = '';
          rooms.forEach(room => {
            roomsHtml += `
              <div class="col-md-4 mb-4">
                <div class="card h-100">
                  <div class="card-body">
                    <h5 class="card-title">${room.name}</h5>
                    <p class="card-text">
                      <strong>Capacity:</strong> ${room.capacity} people<br>
                      <strong>Location:</strong> ${room.location || 'N/A'}<br>
                    </p>
                    <p class="card-text">${room.description || 'No description available.'}</p>
                  </div>
                  <div class="card-footer">
                    <a href="/rooms/${room.id}" class="btn btn-primary">View Details</a>
                  </div>
                </div>
              </div>
            `;
          });
          
          document.getElementById('rooms-container').innerHTML = roomsHtml;
        })
        .catch(error => {
          console.error('Error fetching rooms:', error);
          document.getElementById('rooms-container').innerHTML = `
            <div class="col-12">
              <div class="alert alert-danger">
                Error loading rooms. Please try again later.
              </div>
            </div>
          `;
        });
    }
  });
</script>