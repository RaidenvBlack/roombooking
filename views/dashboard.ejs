<div class="row mb-4">
  <div class="col-md-12">
    <h1>Dashboard</h1>
    <p class="lead">Welcome, <%= user.full_name || user.username %>!</p>
  </div>
</div>

<div class="row mb-4">
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">My Bookings</h5>
        <p class="card-text">View and manage your room bookings.</p>
        <a href="/bookings" class="btn btn-primary">View Bookings</a>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Available Rooms</h5>
        <p class="card-text">Browse and book available rooms.</p>
        <a href="/rooms" class="btn btn-primary">View Rooms</a>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">My Profile</h5>
        <p class="card-text">Update your profile information.</p>
        <a href="/profile" class="btn btn-primary">View Profile</a>
      </div>
    </div>
  </div>
</div>

<% if (user.role === 'admin') { %>
<div class="row mb-4">
  <div class="col-md-12">
    <div class="card bg-light">
      <div class="card-body">
        <h5 class="card-title">Admin Panel</h5>
        <p class="card-text">Access administrative functions to manage rooms, users, and bookings.</p>
        <a href="/admin" class="btn btn-danger">Go to Admin Dashboard</a>
      </div>
    </div>
  </div>
</div>
<% } %>

<div class="row">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Upcoming Bookings</h5>
      </div>
      <div class="card-body">
        <div id="calendar"></div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      events: function(info, successCallback, failureCallback) {
        fetch('/api/bookings')
          .then(response => response.json())
          .then(data => {
            const events = data.map(booking => ({
              id: booking.id,
              title: booking.title,
              start: booking.start_time,
              end: booking.end_time,
              extendedProps: {
                room: booking.room_name,
                description: booking.description,
                status: booking.status
              },
              backgroundColor: getStatusColor(booking.status)
            }));
            successCallback(events);
          })
          .catch(error => {
            console.error('Error fetching bookings:', error);
            failureCallback(error);
          });
      },
      eventClick: function(info) {
        // Show booking details when an event is clicked
        const booking = info.event;
        const props = booking.extendedProps;

        alert(`
          Booking: ${booking.title}
          Room: ${props.room}
          Time: ${moment(booking.start).format('MMMM D, YYYY h:mm A')} - ${moment(booking.end).format('h:mm A')}
          Status: ${props.status}
          ${props.description ? `Description: ${props.description}` : ''}
        `);
      }
    });

    calendar.render();

    function getStatusColor(status) {
      switch(status) {
        case 'confirmed':
          return '#28a745'; // green
        case 'pending':
          return '#ffc107'; // yellow
        case 'cancelled':
          return '#dc3545'; // red
        default:
          return '#007bff'; // blue
      }
    }
  });
</script>

<style>
  #calendar {
    height: 600px;
  }
</style>
